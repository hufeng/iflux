> I think, I am ğŸ”¥ğŸ”¥ğŸ”¥

<pre>
æŠ€æœ¯ä¹Ÿæ˜¯æ—¶å°šé©±åŠ¨çš„ï¼Œæˆ‘ä»¬å¸¸å¸¸è‡£æœäºæ—¶å°š,
é¢å¯¹å¿«é€Ÿçš„å˜åŒ–å¸¸å¸¸è®©æˆ‘ä»¬å±€ä¿ƒä¸å®‰
å¼€å§‹ç„¦è™‘ï¼Œå”¯æé”™è¿‡äº†äº›ä»€ä¹ˆ,æ€ä¹ˆæ‰“ç ´è¿™ç§ç„¦è™‘ï¼Ÿ
éœ€è¦åœ¨å¿«é€Ÿå˜åŒ–å¾—ä¸–ç•Œé‡Œä¿æŒæ¸…é†’ï¼Œä¿æŒç‹¬ç«‹çš„æ€è€ƒå’Œè®¤çŸ¥
è®©æˆ‘ä»¬å›å½’åˆ°æŠ€æœ¯çš„æœ¬è´¨, å› ä¸ºè§£å†³äº†çœŸå®çš„é—®é¢˜ï¼ŒæŠ€æœ¯æ‰å˜å¾—æœ‰ä»·å€¼
<strong>çœŸæ­£ç‰›*çš„æŠ€æœ¯ï¼Œéƒ½æ˜¯é™æ‚„æ‚„çš„è·‘åœ¨çº¿ä¸Š...</strong>
</pre>

### what is iflux ?

_iflux = immer.js + react.js_

a simple state container for React ecosystem.

### Features

- Progressive
- Light-weight
- Reactive
- Predict
- Scalable
- Trace Data Flow

[![NPM](https://nodei.co/npm/iflux.png?downloads=true&downloadRank=true&stars=true)](https://nodei.co/npm/iflux/)

### Why React?

[React.js](http://facebook.github.io/react/)çŠ¹å¦‚ Facebook çš„æ–‡åŒ–åŸºå› æ‰€å¼ºè°ƒçš„ä¸€æ · break things and move fast, åœ¨å¿«é€Ÿå‰è¿›ä¸­æ‰“ç ´äº†å¾ˆå¤šæˆ‘ä»¬å¯¹äº web å¼€å‘çš„å›ºæœ‰è®¤è¯†ã€‚
æ›´å‰å®³çš„æ˜¯ React æŠŠè¿™ç§åˆ›æ–°å¹³ç§»åˆ°ç§»åŠ¨å¼€å‘(React native)å®ç°äº† Learn once, Write everywhere.

### React features

1. å¼ºè°ƒç»„ä»¶åŒ–çš„å¼€å‘æ–¹å¼ï¼ˆæ›´é«˜çš„æŠ½è±¡å±‚æ¬¡ï¼Œæ›´å¥½çš„åˆ†ç¦»å…³æ³¨ç‚¹ï¼‰

2. å£°æ˜å¼çš„å¼€å‘é£æ ¼ï¼ˆæ›´å¥½çš„è¡¨ç°åŠ›ï¼‰

3. å•å‘çš„æ•°æ®æµåŠ¨ï¼ˆç®€å•å¯é¢„æµ‹ï¼‰

4. è¶…é«˜æ€§èƒ½çš„æ¸²æŸ“ï¼ˆæŒå£°åœ¨å“ªé‡Œï¼Ÿï¼‰

5. æœ€å¤§çš„åˆ›æ–°æºäº virtual dom ï¼ˆUI VMï¼‰

6. è½»é‡ï¼Œå¯ä»¥åœ¨ç°æœ‰çš„ç³»ç»Ÿä¸­å¿«é€Ÿè¯•é”™

7. ç²¾ç¡®çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ›´ç®€å•çš„æ•´åˆç¬¬ä¸‰æ–¹çš„åº“(jquery)

### why iflux

å› ä¸º React çš„å®šä½å°±æ˜¯è½»é‡çº§é«˜æ•ˆç»„ä»¶å¼çš„ view libraryï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬å®é™…çš„åº”ç”¨å¼€å‘å·¥ç¨‹ä¸­ä¸ä»…ä»…éœ€è¦å¤„ç† view çš„é—®é¢˜ï¼Œæ›´å¤æ‚çš„æ˜¯å¯¹äºçŠ¶æ€çš„æ§åˆ¶ã€‚

å®˜æ–¹çš„[flux](https://facebook.github.io/flux/docs/overview.html)æ¶æ„æä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„é’ˆå¯¹ React çš„æ¶æ„æŒ‡å¯¼ï¼Œä½†æ˜¯ä»£ç é‡å¾ˆå¤§ã€‚

è¯´åˆ°åº• flux å°±æ˜¯åœ¨è§£å†³ä¸€ä¸ªæ•°æ®æµå‘ä»¥åŠæ§åˆ¶çŠ¶æ€å˜åŒ–é—®é¢˜ã€‚è¿™ç‚¹ om ç¡®å®åšçš„éå¸¸å‡ºè‰²ï¼Œ
å€ŸåŠ©äº Clojure çš„æ•°æ®çš„ç‰¹æ€§ï¼ˆ1. æ•°æ®ä¸å¯å˜ 2. æŒä¹…åŒ–æ•°æ®ç»“æ„ 3.å…±äº«æ•°æ®ç»“æ„ï¼‰

åœ¨ä¸æ–­çš„è¿½å¯»ä¸‹ï¼Œimmutable.js å‡ºç°åœ¨äº†çœ¼å‰ï¼Œå¦‚è·è‡³å®ã€‚
éšç€å¯¹ immutable.js æ·±å…¥æŒ–æ˜ï¼Œå‘ç°æ­£å¥½å¥‘åˆäº† React çš„æ¶æ„ç‰¹ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨ Immutable å¾ˆå¥½çš„ç®¡ç†æˆ‘ä»¬çš„ Storeï¼Œå› ä¸º Immutable å¼ºè°ƒå€¼è¯­ä¹‰ï¼Œ
èƒ½å¤Ÿæ›´å¥½çš„è¿½è¸ªçŠ¶æ€çš„å˜åŒ–(cursor)ä¸”å¸¦æ¥äº†æ›´å¥½çš„æ€§èƒ½ã€‚

éšç€ js ä»£ç é‡è¶Šæ¥è¶Šå¤§,æˆ‘ä»¬éœ€è¦æ›´ safety, scalable çš„æ–¹å¼æ¥å¼€å‘å‰ç«¯ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨ typescriptï¼Œä½†æ˜¯ immutable å’Œ ts é…åˆçš„è¿˜ä¸å¤Ÿå¥½ï¼Œéšç€æŠ€æœ¯çš„å˜åŒ–ï¼Œimmer.js è¿™æ ·çš„å°è€Œç¾çš„åº“å¾ˆå¥½çš„è§£å†³äº† js çš„å€¼ä¸å¯å˜é—®é¢˜ï¼Œåˆèƒ½å¾ˆå¥½å’Œ typescript é…åˆèµ·æ¥

### ä¿æŒç®€å• -- KISS

![iflux-flow](https://raw.githubusercontent.com/hufeng/iflux/4.0/screencast/iflux-flow.png)

### Getting started

```shell
npm install iflux --save
```

react-native environment

```shell
npm install iflux --save
npm install babel-plugin-iflux --save-dev
```

//.babelrc

```javascript
{
  "plugins":[["iflux","reactnative": true]]
}
```

### simple example

```javascript
import React from 'react';
import ReactDOM from 'react-dom';
import { createStore, useRelax, Provider } from 'iflux';

// create state container
const store = createStore({
  state: {
    text: 'ä½ ä¸€æŠ¹å¾®ç¬‘å¦‚èŒ‰è‰^_^',
    count: 1
  }
});

// relax container
function Greeting() {
  const [text, count, setState] = useRelax(['text', 'count']);

  // mutation
  const inc = () =>
    setState(state => {
      state.count++;
    });

  return (
    <div>
      <span>{text}</span>
      <a href='javascript:void(0);' onClick={inc}>
        +{count}
      </a>
    </div>
  );
}

// create Page
function App() {
  return (
    <Provider store={store}>
      <Greeting />
    </Provider>
  );
}

ReactDOM.render(<App />, document.getElementById('app'));
```

### æ›´å¤š demo åœ¨çº¿ä½“éªŒ

[SmileDemo](https://codesandbox.io/embed/8ljj0kvw6j)

[Counter](https://codesandbox.io/embed/zl3jqo1lm)

[todo](https://codesandbox.io/embed/ny43wyw9j)

### page service

åœ¨é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬éµå¾ª page service çš„åˆ’åˆ†ç†å¿µï¼Œå³æ¯ä¸ªé¡µé¢éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å‰ç«¯çš„æœåŠ¡

æ¯ä¸ªé¡µé¢æœ‰è‡ªå·±ç‹¬ç«‹çš„ store, action, ui ç»„ä»¶

åœ¨éœ€è¦è·¨é¡µé¢çš„æ•°æ®å…±äº«å’Œæ•°æ®æ›´æ–°çš„åœºæ™¯ä¸­ï¼Œåœ¨æ•´ä¸ªç³»ç»Ÿçš„é¡¶å±‚ä½¿ç”¨<RootProvider>è¿›è¡ŒåŒ…è£…

å°±å¯ä»¥è§£å†³æ­¤åœºæ™¯ä¸‹çš„é—®é¢˜

å»ºè®®ç›®å½•ç»“æ„:

```text
/tmp/awesome
â¯ tree -L 2
.
â”œâ”€â”€ good-list
â”‚Â Â  â”œâ”€â”€ action.ts
â”‚Â Â  â”œâ”€â”€ component
â”‚Â Â  â”œâ”€â”€ index.ts
â”‚Â Â  â”œâ”€â”€ store.ts
â”‚Â Â  â””â”€â”€ webapi.ts
â”œâ”€â”€ index
â”‚Â Â  â”œâ”€â”€ action.ts
â”‚Â Â  â”œâ”€â”€ component
â”‚Â Â  â”œâ”€â”€ index.ts
â”‚Â Â  â”œâ”€â”€ store.ts
â”‚Â Â  â””â”€â”€ webapi.ts
â”œâ”€â”€ index.ts
â”œâ”€â”€ mine
â”‚Â Â  â”œâ”€â”€ action.ts
â”‚Â Â  â”œâ”€â”€ component
â”‚Â Â  â”œâ”€â”€ index.ts
â”‚Â Â  â”œâ”€â”€ store.ts
â”‚Â Â  â””â”€â”€ webapi.ts
â”œâ”€â”€ order-confirm
â”‚Â Â  â”œâ”€â”€ action.ts
â”‚Â Â  â”œâ”€â”€ component
â”‚Â Â  â”œâ”€â”€ index.ts
â”‚Â Â  â”œâ”€â”€ store.ts
â”‚Â Â  â””â”€â”€ webapi.ts
â”œâ”€â”€ order-list
â”‚Â Â  â”œâ”€â”€ action.ts
â”‚Â Â  â”œâ”€â”€ component
â”‚Â Â  â”œâ”€â”€ index.ts
â”‚Â Â  â”œâ”€â”€ store.ts
â”‚Â Â  â””â”€â”€ webapi.ts
â”œâ”€â”€ setting
â”‚Â Â  â”œâ”€â”€ action.ts
â”‚Â Â  â”œâ”€â”€ component
â”‚Â Â  â”œâ”€â”€ index.ts
â”‚Â Â  â”œâ”€â”€ store.ts
â”‚Â Â  â””â”€â”€ webapi.ts
â””â”€â”€ shopping-cart
    â”œâ”€â”€ action.ts
    â”œâ”€â”€ component
    â”œâ”€â”€ index.ts
    â”œâ”€â”€ store.ts
    â””â”€â”€ webapi.ts

14 directories, 29 files
```

## Domain Object

### Provider

è¿æ¥å½“å‰çš„é¡µé¢çš„ç»„ä»¶ å’Œå½“å‰çš„é¡µé¢çš„æ•°æ®å®¹å™¨(store)ï¼Œåœ¨ provider å†…éƒ¨å°† store ç»‘å®šåœ¨å½“å‰çš„é¡µé¢ä¸Šä¸‹æ–‡

æ–¹ä¾¿ relax æ³¨å…¥æ•°æ®æº, Provider æä¾›äº†ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸçš„å›è°ƒ onMounted, willUnmout æ–¹ä¾¿è¿›è¡Œä¸€äº›å…¨å±€æ“ä½œ

```javascript
import { Provider } from 'iflux';

// åˆ›å»ºä¸€ä¸ªé¡µé¢çš„æ•°æ®store
const store = createStore({ state: { text: 'hello world' } });

function App() {
  const onMounted = store => {
    store.dispatch('onInit');
  };

  const willUnmount = store => {
    console.log('unmounted');
  };

  return (
    <Provider store={store} onMounted={onMounted} willUnmount={willUnmount}>
      <Hello />
    </Provider>
  );
}
```

### useRelax

ä½¿ç”¨ React@16.8 çš„æ–°ç‰¹æ€§ React hook, ä»¥ä¸€ç§å£°æ˜å¼çš„é£æ ¼è·å– store ä¸­çš„æ•°æ®ï¼Œ ä»¥åŠæ›´å˜ store ä¸­çš„ state çš„æ–¹å¼

```javascript
import React from 'react';
import { useRelax } from 'iflux';

function Hello() {
  const { id, title, content } = useRelax(['id', 'title', 'content']);

  return (
    <div>
      <div>{id}</div>
      <div>{title}</div>
      <div>{content}</div>
    </div>
  );
}
```

useRelax æ•°ç»„ä¸­çš„å‚æ•°é£æ ¼æ˜¯å¯¹åº”çš„æ•°æ®çš„è·¯å¾„

å‡è®¾æˆ‘ä»¬çš„ store ä¸­çš„ state æ•°æ®ç»“æ„æ˜¯

```js
createStore({
  state: {
    list: [{ id: 1, title: 'hello iflux', conent: 'welcome' }],
    motto: 'build tools for human',
    nest: { user: { where: 'nanjing' } }
  }
});
```

1. å‡å¦‚æƒ³è·å– list ä¸­çš„ï¼Œindex ä¸º 0 çš„ title

   å¯¹åº”çš„è·¯å¾„æ˜¯ ['list', 0, 'title'] æˆ–è€… æ›´ç®€ç•¥æ˜¯ 'list.0.title'

   ä¾‹å¦‚:

   ```javascript
   const { title } = useRelax(['list.0.title']);
   const { title } = useRelax([['list', 0, 'title']]);
   ```

   ä¸ºå•¥æ˜¯ const {title}, useRelax åœ¨ parse æˆ‘ä»¬çš„æ•°æ®è·¯å¾„æ˜¯é»˜è®¤ä»¥æœ€åä¸€ä¸ªè·¯å¾„ä¸ºè¿”å›å¯¹è±¡çš„ key

   é‚£å¦‚æœæˆ‘æƒ³è‡ªå®šä¹‰è¿™ä¸ªå­—æ®µ æ€ä¹ˆåŠå‘¢ï¼Ÿé‚£å°±ä»¥å¯¹è±¡çš„æ–¹å¼æ¥

   ```javascript
   const { a } = useRelax([{ a: 'list.0.title' }]);
   ```

2. å¦‚æœæƒ³è·å– motto ä¹Ÿæ˜¯ä»¥è·¯å¾„çš„æ–¹å¼

   ```javascript
   const { motto } = useRelax(['motto']);
   //è‡ªå®šä¹‰åå­—
   const { A } = useRelax([{ A: 'motto' }]);
   ```

3. è·å–å¯¹è±¡çš„åµŒå¥—è·¯å¾„, è·å– where

```javascript
const { where } = useRelax(['nest.user.where']);
//è‡ªå®šä¹‰
const { there } = useRelax([{ there: 'nest.user.where' }]);
```

> **æ‰€ä»¥è¯´äº†è¿™ä¹ˆå¤šï¼Œå…¶å®å°±ä¸€æ¡è§„åˆ™ï¼Œä»¥æ•°æ®è·¯å¾„çš„æ–¹å¼æ¥è·å–æ•°æ®ï¼Œ æ”¯æŒè‡ªå®šä¹‰æœ€ç»ˆçš„è¿”å›å€¼å¾—åç§°**

### Relax

Relax æ˜¯ useRelax çš„é™çº§æ¨¡å¼ï¼Œåœ¨ä½ç‰ˆæœ¬çš„ä¸æ”¯æŒ React çš„ hook ç‰¹æ€§çš„ React class component ä¸­ï¼Œä½¿ç”¨ Relax è¿™ä¸ª decorator åšåˆ°å£°æ˜å¼çš„æ•°æ®ä¾èµ–æ³¨å…¥

```typescript
import React from 'react';
import { Relax, TRelaxProps } from 'iflux';

// å‚æ•°å’ŒuseRelaxå®Œå…¨ä¸€è‡´çš„æ•°æ®è·¯å¾„é£æ ¼
@Relax(['list.0.title', 'motto', 'nest.user.where'])
class Hello extends React.Component {
  relaxProps = {} as TRelaxProps<{
    title: string;
    motto: string;
    where: string;
  }>;

  render() {
    const { title, motto, where } = this.relaxProps;

    return (
      <div>
        <div>{id}</div>
        <div>{title}</div>
        <div>{content}</div>
      </div>
    );
  }
}
```

åœ¨ Relax æˆ–è€… useRelax ä¸­ä¸éœ€è¦å£°æ˜ä¼šè‡ªåŠ¨æ³¨å…¥æ”¹å˜ store çš„ state çš„æ–¹æ³•ï¼ŒsetState å’Œ dispatch

```javascript
function Hello() {
  const { title, setState, dispatch } = useRelax(['list.0.title']);

  //mutation
  const onChange = () =>
    setState(state => {
      state.list[0].title = 'hello iflux ++';
    });

  return (
    <div>
      <a href={'javascript:void(0);'} onClick={onChange}>
        setState
      </a>
      {title}
      <a href='javascript:void(0);' onClick={() => dispatch('change-title')}>
        dispatch
      </a>
    </div>
  );
}
```

dispatch VS setState

dispatch(msg: string, params?: any) ä¼šè‡ªåŠ¨çš„ä» store ä¸­å¯»æ‰¾ action ä½œä¸ºæ•°æ®æ›´æ–°ï¼Œæ›´å¥½çš„ trace
setState(cb: (state) => void) æä¾›ä¸€ç§å¿«é€Ÿä¾¿æ·ä¿®æ”¹ store ä¸­ state çš„æ–¹å¼ï¼Œæ¯”å¦‚ form ä¸­ field çš„æ›´æ–°

> ä¼˜å…ˆä½¿ç”¨ dispatch è¿›è¡Œæ•°æ®æ›´æ–°

### Action

æä¾›å¯¹ store ä¸­æ•°æ®ä¿®æ”¹çš„æŠ½è±¡

```javascript
// action.js
// åœ¨è¿™ä¸ªæ–‡ä»¶å®šä¹‰æ‰€æœ‰çš„action
import { action } from 'iflux';

export const changeTitle = action('changeTitle', store => {
  store.setState(state => {
    state.list[0].title = 'hello iflux ++';
  });
});

//store.jså»ç»‘å®šæ‰€æœ‰çš„action
import { createStore } from 'iflux';
import * as action from './action';

export default createStore({
  action,
  state: {
    list: [{ id: 1, title: 'hello iflux', conent: 'welcome' }],
    motto: 'build tools for human',
    nest: { user: { where: 'nanjing' } }
  }
});
```

è¿™æ · relax åœ¨ dispatch çš„æ—¶å€™ï¼Œå°±ä¼šä» store ä¸­æ‰¾å¯»é‚£ä¸ª action å¯ä»¥åŒ¹é… dispatch çš„ msg ç„¶åè¿›è¡Œå¤„ç†

### QL

QL = query languageï¼Œä¸€ç§ç®€å•çš„ reactive çš„ DSLï¼Œç±»å‹ vue çš„ compute å’Œ Redux ä¸­çš„ selected

ä½¿ç”¨ QL çš„æŠ½è±¡ä¸»è¦æ˜¯å¯¹æ•°æ®ä¹‹é—´çš„å…³ç³»è¿›è¡ŒæŠ½è±¡ï¼Œå°†æ•°æ®åˆ†ä¸ºä¸¤ç§ä¸€ä¸ªæ˜¯ source data(æºæ•°æ®), ä¸€ç§æ˜¯ derive data(æ´¾ç”Ÿæ•°æ®)
å°±æ˜¯åŸºäºæºæ•°æ®å’ŒæŸä¸ªè§„åˆ™è®¡ç®—å‡ºæ¥çš„æ•°æ®ï¼Œ QL å°±æ˜¯å°è£…æ´¾ç”Ÿæ•°æ®ï¼Œæœ€åä¸€ä¸ªå‚æ•°æ˜¯è®¡ç®—è§„åˆ™ï¼Œå‰é¢çš„å‚æ•°å…¨æ˜¯æºæ•°æ®çš„è·¯å¾„

å®é™…åœ¨å‰ç«¯æœ‰å¤§é‡çš„è¿™æ ·çš„åœºæ™¯ï¼Œæ¯”å¦‚ï¼Œè®¡ç®—è´­ç‰©è½¦çš„æ€»é‡‘é¢ï¼Œtotal = [(sku price * buy num)..... ]
å½“è´­ä¹°çš„æ•°é‡è¿˜æ˜¯å•ä»·å‘ç”Ÿäº†å˜åŒ–ï¼Œtotal å°±åº”è¯¥è®¡ç®—ä¸€æ¬¡ï¼Œ

å¿…é¡» excelï¼ŒA1-A50 éƒ½æ˜¯å­¦ç”Ÿçš„æˆç»©ï¼ŒA51 æ˜¾ç¤ºçš„æ˜¯æ€»åˆ†ï¼Œå¯¹äº A51 æ¥è¯´å°±æ˜¯ä¸€ä¸ªè§„åˆ™, :=sum(A1, A50)åªè¦ A1-A50 ä»»ä½•ä¸€è¡Œå‘ç”Ÿçš„å˜åŒ–
A51 éƒ½æ˜¯è‡ªåŠ¨é‡æ–°è®¡ç®—ä¸€æ¬¡

è¿™æ ·çš„å¥½å¤„ï¼Œä½¿æˆ‘ä»¬çš„é€»è¾‘æ›´åŠ çš„æ¸…æ™°ï¼Œæˆ‘ä»¬é€šå¸¸åªè¦å…³æ³¨æºæ•°æ®å°±å¯ä»¥äº†ï¼Œ
ä»¥åŠ store ä¸­å­˜æ”¾ state éƒ½æ˜¯æºæ•°æ®ã€‚

æˆ‘ä»¬çš„ QL ä¼šåœ¨ Relax æˆ–è€… useRelax å£°æ˜çš„ä¾èµ–ä¸­è‡ªåŠ¨è®¡ç®—ï¼Œä¹Ÿè®¸ä½ ä¼šé—®ï¼Œè¿™æ ·ä¸ä¼šå¯¼è‡´è®¡ç®—é‡å˜å¤§å—ï¼Ÿ

è¿™å°±æ˜¯æˆ‘ä»¬ç”¨ immutable æ•°æ®ç»“æ„çš„ä¼˜åŠ¿ï¼Œå¯ä»¥çŸ¥é“æºæ•°æ®æœ‰æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå¯ä»¥æ–¹ä¾¿çš„åš cacheã€‚

```javascript
import { QL } from 'iflux';

const helloQL = QL([
  //ä¾èµ–çš„æ•°æ®è·¯å¾„
  // storeä¸­çš„stateçš„titleæ•°æ®è·¯å¾„
  'list.0.title',
  //storeä¸­çš„stateçš„whereçš„æ•°æ®è·¯å¾„
  'nested.user.where',

  /**
   * transform function
   * title => list.0.titleçš„å€¼
   * where => nested.user.whereçš„å€¼
   * ç„¶åä¸€ä¸ªè¿”å›å€¼, å½“ä¾èµ–çš„æ•°æ®è·¯å¾„å¯¹åº”çš„å€¼ä»»ä½•ä¸€ä¸ªå‘ç”Ÿ
   * äº†æ”¹å˜ï¼Œæ”¹å‡½æ•°éƒ½ä¼šè‡ªåŠ¨é‡æ–°è®¡ç®—ä¸€æ¬¡
   */
  (title, where) => {
    // computed
    return `${title} ++ ${where}`;
  }
]);

// QLæ”¯æŒåµŒå¥—
const worldQL = QL([
  helloQL,
  'motto',
  (hello, motto) => `${hello} +++ ${motto}`
]);
```

```typescript
import { helloQL, worldQL } from './ql';

function Hello() {
  const { helloQL } = useRelax([{ helloQL }]);

  return <div>{helloQL}</div>;
}

@Relax([{ worldQL }])
class World extends React.Component {
  relaxProps = {} as TRelaxProp<{ worldQL: string }>;
  render() {
    return <div>{this.relaxProps.worldQL}</div>;
  }
}
```

### EL

EL = Effect language, å¯¹ sideEffect çš„æŠ½è±¡, å’Œ QL å’Œç±»ä¼¼ä½†æ˜¯ä¸å…³å¿ƒè¿”å›å€¼ï¼Œ

ä¸»è¦å°±æ˜¯ç›‘æ§æºæ•°æ®æˆ–è€…æŸä¸ª ql çš„å€¼æ˜¯ä¸æ˜¯å‘ç”Ÿå˜åŒ–ï¼Œç„¶ååšä¸€äº›é¢å¤–çš„äº‹æƒ…

æ¯”å¦‚å‘é€ ajaxï¼Œ

EL ä¸æ”¯æŒåµŒå¥—ï¼Œå› ä¸ºä¸ä¿è¯æœ‰è¿”å›å€¼ ^\_^

```js
import { EL } from 'iflux';

const helloEL = EL([
  //æ•°æ®è·¯å¾„
  'list.0.title',
  helloQL,

  (title, helloQL) => {
    //send a ajax
  }
]);

// æ‰§è¡Œçš„å®¹å™¨åœ¨storeä¸­
createStore({
  el: {helloEL}
  state: {}
})
```

### RootProvider, createRootStore

è™½ç„¶æˆ‘ä»¬çš„å¼€å‘æŒ‰ç…§ page-service çš„æ–¹å¼æ¥è¿›è¡Œæ‹†åˆ†ï¼Œä¿è¯æ¸…æ™°

ä½†æ˜¯åœ¨æ•´ä¸ªç³»ç»Ÿä¸­å¸¸å¸¸éœ€è¦åœ¨ä¸åŒçš„é¡µé¢è¿›è¡Œæ•°æ®çš„å…±äº«å’Œæ›´æ–°

æ€ä¹ˆè§£å†³è·¨é¡µé¢çš„æ•°æ®é—®é¢˜å‘¢ï¼Ÿ

è¿™ä¸ªæ—¶å€™å°±éœ€è¦ RootProvider, è¿™æ ·å°±å¯ä»¥å»ºç«‹ä¸€ä¸ªå…¨å±€çš„ä¸Šä¸‹æ–‡ï¼Œåœ¨ç³»ç»Ÿçš„é¡¶å±‚æ¯”å¦‚ï¼š

```javascript
ReactDOM.render(
  <RootProvider>
    <Router>
      <Route path='/' component={Blog} />
      <Route exact path='/blog-new' component={BlogCreate} />
      <Route exact path='/blog/:id' component={BlogDetail} />
    </Router>
  </RootProvider>,
  document.getElementById('app')
);
```

éšç€é¡µé¢çš„åŠ è½½æ¸è¿›å¼çš„æŠŠé¡µé¢çš„æ•°æ®å…±äº«ç»™ RootProvider,æ–¹ä¾¿ä¸ªé¡µé¢çš„è·å–

æ¯”å¦‚ä¸€ä¸ªä¸šåŠ¡æµç¨‹ï¼ŒA -> B -> C, æŒ‰ç…§æˆ‘ä»¬çš„æŠ½è±¡ A, B, C æ˜¯ä¸‰ä¸ªé¡µé¢

æˆ‘ä»¬å¯ä»¥åœ¨ B ä¸­è·å– A æ•°æ®ï¼Œ åœ¨ C ä¸­è·å– Aï¼ŒB æ•°æ®ï¼Œ

**å¦‚æœåœ¨ A ä¸­è·å– Bï¼ŒC çš„æ•°æ®åˆ™å¯èƒ½å‡ºç°é”™è¯¯**

æ€ä¹ˆæ¸è¿›å¼çš„å…±äº«

1. RootProvider æ”¾åœ¨é¡¶å±‚

2. å„ä¸ªé¡µé¢çš„ store è®¾ç½® ns(namespace)é¿å…æ•°æ®çš„äºŒä¹‰æ€§

3. å¦‚æœéœ€è¦å…¨å±€çš„æ•°æ®å…±äº«å¯ä»¥ä½¿ç”¨ createRootStore

```javascript
  //page-a.js
  const store = createStore({
    ns: 'page-a'
    state: {}
  })

  function PageA() {
    return (
      <Provider store={store}>
       <Page/>
      </Provider>
    );
  }

  //page-b.js
   const store = createStore({
    ns: 'page-b'
    state: {}
  })

  function PageB() {
    return (
      <Provider store={store}>
       <Page/>
      </Provider>
    );
  }

  //å…¥å£index.js

  function Index() {
    return (
      <RootProvider>
        <PageA/>
        <PageB/>
      </RootProvider>
    )
  }
```

é‚£æ€ä¹ˆè·å–å…±äº«æ•°æ®å‘¢ï¼Ÿ

relax å¤§æ³•ï¼Œåœ¨æ•°æ®è·¯å¾„çš„å¼€å§‹@ä¸Šçˆ¶é¡µé¢çš„ namespaceï¼Œ

å¦‚ï¼š

åŠ å…¥çˆ¶é¡µé¢çš„ store è®¾ç½®çš„ ns æ˜¯, 'shoppingCart',

```js
createStore({
  ns: 'shoppingCart',
  state: {
    list: [{ id: 1, name: 'testå•†å“', price: 0.01 }]
  }
});
```

å­é¡µé¢æƒ³è·å–ä»·æ ¼:

```javascript
function Price() {
  const { price } = useRelax(['@shoppingCart.list.0.price']);

  return <div>{price}</div>;
}
```
